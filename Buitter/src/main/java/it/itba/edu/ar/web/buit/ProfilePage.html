<html>
	<body>
		<wicket:extend>
			<div class="container">
				<c:if test="${not empty user || user_info.privacy=='false'}">
					<div class="row row-offcanvas row-offcanvas-right">
						<div class="col-md-8 col-md-offset-2">
							<div wicket:id="headerPanel"/>
							<div class="well well-lg">
								<c:if test="${user == user_info.username }">
									<div class="input-group buit-compose-form">
										<form method="post" action="buit">
											<fieldset>
												<textarea id="buit-field" class="form-control" rows="3" name="buit" placeholder="Compose new Buit..." maxlength="140"></textarea>
												Remaining: <span  id='remainingC'>140</span>
		                    					<c:if test="${not empty error_buit}">
		                       						<p class="text-danger" style="margin-bottom: 0px"><small><em>Your buit is empty<c:out value="${error_buit}"/></em></small></p>
		                    					</c:if>
											<button type="submit" class="btn btn-primary pull-right buit-compose-button">Buit</button>
											</fieldset>
										</form>
									</div> <!-- .input-group .buit-compose-form -->
								</c:if>
								<c:choose>
									<c:when test="${empty buits}">
										<div class="alert-box">
											<img src="../../../img/logo.png" class="logo-alt" /> <br />@<c:out value="${user_info.username}" /> hasn't buited yet.
										</div>
									</c:when>
									<c:otherwise>
										<h3 class="text-bold" style="margin-left:40px">Buits</h3>
										<c:forEach items="${buits}" var="buit">
											<div class="media buit">
												<c:if test="${not empty user_info.photo}">
													<img class="pull-left media-object buit-profile-pic" src="../../image?name=<c:out value="${user_info.username}"/>"/>
												</c:if>
												<c:if test="${empty user_info.photo}">
													<img class="pull-left media-object buit-profile-pic" src="../../../img/nopicture.png"/>
												</c:if>
												<div class="media-body">
													<div class="media-heading">
														<span class="pull-left text-bold">@<c:out value="${buit.buitter.username}" /></span> <span class="pull-right text-muted" style="font-size:15px "><fmt:formatDate type="both" value="${buit.date}" /></span>
													</div>
													<br />
													<p style="word-wrap:break-word">${buit.message}</p>
													<c:if test="${buit.isrebuit == true}">
														<p class="pull-left text-muted" style="margin-bottom:0px;">Rebuited from @${buit.user.username}</p>
													</c:if>
													<c:if test="${not empty user}">
														<c:if test="${user == user_info.username }">
															<button id="<c:out value="${buit.id}"/>" type="button" onclick="proceed(this.id);" class="pull-right btn btn-link btn-xs"><i class="icon-trash"> Delete</i></button>
														</c:if>
														<!-- Cambiar los valores para el favorito y hacer la funcion javascript. Poner ifs-->
														<c:set var="found" value='false'/>
														<c:forEach items="${buit.favoritter}" var="us">
															<c:if test="${us.username == user}"><c:set var="found" value='true'/></c:if>
														</c:forEach>
														<c:if test="${found == 'true'}"><c:set var="method" value='Unfavorite'/></c:if>
														<c:if test="${found == 'false'}"><c:set var="method" value='Favorite'/></c:if>
														<button id="<c:out value="${buit.id}"/>" type="button" onclick="favorite(this.id, '<c:out value="${method}"/>');" class="pull-right btn btn-link btn-xs"><i class="icon-star"> <c:out value="${method}"/></i></button>
														<!-- cambiar lso valores para rebuiteo y hacer la funcion javscript. Poner los ifs-->
														<c:if test="${user != user_info.username }">
															<button id="<c:out value="${buit.id}"/>" type="button" onclick="rebuit(this.id);" class="pull-right btn btn-link btn-xs"><i class="icon-retweet"> Rebuit</i></button>
														</c:if>
													</c:if>	
												</div> <!-- .media-body -->
											</div> <!-- .media .buit -->
										</c:forEach>
									</c:otherwise>
								</c:choose>
							</div> <!-- .well .well-lg -->
						</div> <!-- .col-md-8 .col-md-offset-2 -->
					</div> <!-- .row .row-offcanvas .row-offcanvas-right -->
				</c:if>
				<c:if test="${empty user && user_info.privacy=='true'}">
					<div class="bs-example">
        				<div class="jumbotron">
        					<img style="display: block; margin-left: auto;  margin-right: auto;" src="img/stop_vulture.png"/>
          					<h2 style="text-align:center">Sorry, user @<c:out value="${user_info.username}"/> is private</h2>
          					<p style="text-align:center">You must be logged in to see this profile.</p>
        				</div> <!-- .jumbotron -->
   					</div> <!-- .bs-example -->
				</c:if>
			</div> <!-- .container -->
		</wicket:extend>
	</body>
</html>

<script>
	var txtBoxRef = document.getElementById("buit-field");
	var counterRef = document.getElementById("remainingC");
	txtBoxRef.addEventListener("input",function(){
		var remLength = 0;
		remLength = 140 - txtBoxRef.value.length;
		if(remLength >= 0){
			counterRef.innerHTML = remLength;
		}
	},true);
</script>

<script>
	function proceed(clicked_id) {
		var form = document.createElement('form');
		form.setAttribute('method', 'post');
		form.setAttribute('action', 'delete');
		form.style.display = 'hidden';
		var input = document.createElement('input');
		input.setAttribute('type','text');
		input.setAttribute('name','buitid');
		input.setAttribute('value', clicked_id);
		input.style.display = 'hidden';
		form.appendChild(input);
		document.body.appendChild(form);
		form.submit();
	}
</script>
<script>
	function favorite (id, method) {
		var form = document.createElement('form');
		form.setAttribute('method', 'post');
		form.setAttribute('action', method.toLowerCase());
		form.style.display = 'hidden';
		var input = document.createElement('input');
	    input.setAttribute('type','text');
		input.setAttribute('name','buitid');
		input.setAttribute('value', id);
		input.style.display = 'hidden';
		form.appendChild(input);
		document.body.appendChild(form);
		form.submit();
	}
	
	function rebuit (id) {
		var form = document.createElement('form');
		form.setAttribute('method', 'post');
		form.setAttribute('action', 'rebuit');
		form.style.display = 'hidden';
		var input = document.createElement('input');
	    input.setAttribute('type','text');
		input.setAttribute('name','buitid');
		input.setAttribute('value', id);
		input.style.display = 'hidden';
		form.appendChild(input);
		document.body.appendChild(form);
		form.submit();
	}
</script>